"use strict";(self.webpackChunklibrephotos_docs=self.webpackChunklibrephotos_docs||[]).push([[335],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,f=u["".concat(s,".").concat(d)]||u[d]||m[d]||o;return n?i.createElement(f,a(a({ref:t},c),{},{components:n})):i.createElement(f,a({ref:t},c))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,a[1]=l;for(var p=2;p<o;p++)a[p]=n[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8037:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var i=n(7462),r=(n(7294),n(3905));const o={title:"\u2753 FAQ",excerpt:"Scan always fails after importing few images",sidebar_position:7},a=void 0,l={unversionedId:"user-guide/faq",id:"user-guide/faq",title:"\u2753 FAQ",description:"Proxmox - Scan always fails after importing few images",source:"@site/docs/user-guide/faq.md",sourceDirName:"user-guide",slug:"/user-guide/faq",permalink:"/docs/user-guide/faq",draft:!1,editUrl:"https://github.com/LibrePhotos/librephotos.docs/tree/master/docs/user-guide/faq.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"\u2753 FAQ",excerpt:"Scan always fails after importing few images",sidebar_position:7},sidebar:"userguide",previous:{title:"\ud83d\udca1 Feature Comparison",permalink:"/docs/user-guide/features"},next:{title:"Development",permalink:"/docs/development/"}},s={},p=[{value:"Proxmox - Scan always fails after importing few images",id:"proxmox---scan-always-fails-after-importing-few-images",level:2},{value:"Symptom",id:"symptom",level:3},{value:"Solution:",id:"solution",level:3},{value:"Steps for Proxmox 6.4:",id:"steps-for-proxmox-64",level:3}],c={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"proxmox---scan-always-fails-after-importing-few-images"},"Proxmox - Scan always fails after importing few images"),(0,r.kt)("h3",{id:"symptom"},"Symptom"),(0,r.kt)("p",null,"You get errors like these and you use Proxmox:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Thread 0x00007fc8dcf3f640 (most recent call first):\n  File "/usr/lib/python3.9/threading.py", line 316 in wait\n  File "/usr/lib/python3.9/threading.py", line 574 in wait\n  File "/usr/local/lib/python3.9/dist-packages/tqdm/_monitor.py", line 59 in run\n  File "/usr/lib/python3.9/threading.py", line 954 in _bootstrap_inner\n  File "/usr/lib/python3.9/threading.py", line 912 in _bootstrap\n\nCurrent thread 0x00007fc998cf8640 (most recent call first):\n  File "/usr/local/lib/python3.9/dist-packages/face_recognition/api.py", line 162 in <listcomp>\n  File "/usr/local/lib/python3.9/dist-packages/face_recognition/api.py", line 162 in _raw_face_landmarks\n  File "/usr/local/lib/python3.9/dist-packages/face_recognition/api.py", line 209 in face_encodings\n  File "/code/api/models/photo.py", line 507 in _extract_faces\n  File "/code/api/directory_watcher.py", line 168 in handle_new_image\n  File "/code/api/directory_watcher.py", line 261 in photo_scanner\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 51 in starmapstar\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 125 in worker\n  File "/usr/lib/python3.9/multiprocessing/process.py", line 108 in run\n  File "/usr/lib/python3.9/multiprocessing/process.py", line 315 in _bootstrap\n  File "/usr/lib/python3.9/multiprocessing/popen_fork.py", line 71 in _launch\n  File "/usr/lib/python3.9/multiprocessing/popen_fork.py", line 19 in __init__\n  File "/usr/lib/python3.9/multiprocessing/context.py", line 277 in _Popen\n  File "/usr/lib/python3.9/multiprocessing/process.py", line 121 in start\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 326 in _repopulate_pool_static\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 337 in _maintain_pool\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 513 in _handle_workers\n  File "/usr/lib/python3.9/threading.py", line 892 in run\n  File "/usr/lib/python3.9/threading.py", line 954 in _bootstrap_inner\n  File "/usr/lib/python3.9/threading.py", line 912 in _bootstrap\n')),(0,r.kt)("h3",{id:"solution"},"Solution:"),(0,r.kt)("p",null,"This is a problem with proxmox, More specifically with the way the CPU was emulated. By default, QEMU in Proxmox uses its own CPU type kvm64, which has a reduced CPU flags set, to guaranteed that it works everywhere. This means that necessary flags like SSE and AVX are absent, which causes the Fatal Python error: Illegal instruction error."),(0,r.kt)("p",null,"To fix this, one must either manually edit the .conf file and add the flags needed to the kvm64 CPU type, or pick a different method of CPU emulation."),(0,r.kt)("p",null,"To add the flags, edit the xxx.conf file located in /etc/pve/qemu-server/ where xxx is the ID of the VM. The manual can be found here: ",(0,r.kt)("a",{parentName:"p",href:"https://pve.proxmox.com/wiki/Manual:_qm.conf"},"https://pve.proxmox.com/wiki/Manual:_qm.conf")),(0,r.kt)("p",null,"If you don't care about live migration and moving VMs between nodes, the much easier option is to just change the CPU type to Host. With the Host option, the VM will match the CPU type of the host machine."),(0,r.kt)("h3",{id:"steps-for-proxmox-64"},"Steps for Proxmox 6.4:"),(0,r.kt)("p",null,'Select your VM and then Hardware tab.\n{% include figure image_path="/assets/images/135711616-14903f44-2bdc-4830-82e9-a29562f75762.png" alt="Select your VM and then Hardware tab" %}\nThen double-click on Processors or select it and click Edit:\n{% include figure image_path="/assets/images/135711657-3cdc2600-2368-440c-af75-00313c8c8997.png" alt="Then double-click on Processors or select it and click Edit"  %}'))}m.isMDXComponent=!0}}]);