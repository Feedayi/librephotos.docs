"use strict";(self.webpackChunklibrephotos_docs=self.webpackChunklibrephotos_docs||[]).push([[7895],{3905:(e,t,o)=>{o.d(t,{Zo:()=>d,kt:()=>f});var n=o(7294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(o),m=r,f=c["".concat(p,".").concat(m)]||c[m]||u[m]||i;return o?n.createElement(f,a(a({ref:t},d),{},{components:o})):n.createElement(f,a({ref:t},d))}));function f(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=o.length,a=new Array(i);a[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[c]="string"==typeof e?e:r,a[1]=l;for(var s=2;s<i;s++)a[s]=o[s];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}m.displayName="MDXCreateElement"},2500:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var n=o(7462),r=(o(7294),o(3905));const i={title:" \ud83d\udcc1 Upload",excerpt:"How to uploading photos works as a developer",sidebar_position:5},a=void 0,l={unversionedId:"development/contribution/mobile/upload",id:"development/contribution/mobile/upload",title:" \ud83d\udcc1 Upload",description:"How does it work?",source:"@site/docs/development/contribution/mobile/upload.md",sourceDirName:"development/contribution/mobile",slug:"/development/contribution/mobile/upload",permalink:"/docs/development/contribution/mobile/upload",draft:!1,editUrl:"https://github.com/LibrePhotos/librephotos.docs/tree/master/docs/development/contribution/mobile/upload.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:" \ud83d\udcc1 Upload",excerpt:"How to uploading photos works as a developer",sidebar_position:5},sidebar:"userguide",previous:{title:"\u2601\ufe0f Local Images",permalink:"/docs/development/contribution/mobile/local-images"},next:{title:"\ud83d\uddb1\ufe0f To-Do",permalink:"/docs/development/contribution/mobile/to-do"}},p={},s=[{value:"How does it work?",id:"how-does-it-work",level:3},{value:"Differences to the frontend",id:"differences-to-the-frontend",level:3}],d={toc:s},c="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(c,(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h3",{id:"how-does-it-work"},"How does it work?"),(0,r.kt)("p",null,"It uses the ",(0,r.kt)("a",{parentName:"p",href:"/docs/development/contribution/backend/upload"},"endpoints")," of the backend to upload the files in chunks. The steps are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Only show button if upload is enabled in admin area"),(0,r.kt)("li",{parentName:"ul"},"Check if file is on the server by using the ",(0,r.kt)("inlineCode",{parentName:"li"},"exists")," endpoint."),(0,r.kt)("li",{parentName:"ul"},"If it is, don't upload it"),(0,r.kt)("li",{parentName:"ul"},"If it isn't, upload it with the ",(0,r.kt)("inlineCode",{parentName:"li"},"upload")," endpoint"),(0,r.kt)("li",{parentName:"ul"},"If the upload is complete, call the ",(0,r.kt)("inlineCode",{parentName:"li"},"complete")," endpoint"),(0,r.kt)("li",{parentName:"ul"},"If all files are uploaded, call the ",(0,r.kt)("inlineCode",{parentName:"li"},"scanuploadedphotos")," endpoint")),(0,r.kt)("p",null,"This is implemented in the ",(0,r.kt)("inlineCode",{parentName:"p"},"UploadSlice"),", where you can call the action ",(0,r.kt)("inlineCode",{parentName:"p"},"uploadImages")," to upload the images. The progress is saved wihtin the slice as ",(0,r.kt)("inlineCode",{parentName:"p"},"total")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"current"),"."),(0,r.kt)("h3",{id:"differences-to-the-frontend"},"Differences to the frontend"),(0,r.kt)("p",null,"To continue using blobs, we need to use ",(0,r.kt)("inlineCode",{parentName:"p"},"react-native-blob-util")," to convert the file to a blob and chunk it. The library is not well documented, so it took some time to figure out how to use it. The types are mostly wrong, which is the reason for a lot of ",(0,r.kt)("inlineCode",{parentName:"p"},"any")," types.\nBlobs get created asynchronously, so we need to wrap chunking in a ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise.all")," to get the actual blobs."),(0,r.kt)("p",null,"We cannot use redux-query when using the ",(0,r.kt)("inlineCode",{parentName:"p"},"upload")," endpoint, because it is based on fetch. Fetch isn't correctly implemented yet on androids okhttp library. When we use it, we will get a ",(0,r.kt)("inlineCode",{parentName:"p"},"Network error"),". So we use axios instead."))}u.isMDXComponent=!0}}]);